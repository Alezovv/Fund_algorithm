# === –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ ===
CC := gcc
CFLAGS := -Wall -Wextra -std=c11 -Iinclude

# === –ö–∞—Ç–∞–ª–æ–≥–∏ ===
SRC_DIR := src
OBJ_DIR := object
BIN_DIR := bin
TEST_DIR := tests

# === –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ ===
SRC := $(wildcard $(SRC_DIR)/*.c)
OBJ := $(patsubst $(SRC_DIR)/%.c,$(OBJ_DIR)/%.o,$(SRC))

# === –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ ===
TARGET := $(BIN_DIR)/main

# === –¢–µ—Å—Ç—ã ===
TEST_SRC := $(wildcard $(TEST_DIR)/*.c)
TEST_BIN := $(BIN_DIR)/test
TEST_SRC_FULL := $(filter-out $(SRC_DIR)/main.c,$(SRC)) # –≤—Å–µ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –∫—Ä–æ–º–µ main.c

# === –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ===
all: $(TARGET)

# === –ö–æ–º–ø–∏–ª—è—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã ===
$(TARGET): $(OBJ) | $(BIN_DIR)
	@echo "üîß Linking main..."
	$(CC) $(OBJ) -o $(TARGET)
	@echo "‚úÖ Build complete: $(TARGET)"

# === –ö–æ–º–ø–∏–ª—è—Ü–∏—è .c ‚Üí .o ===
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c | $(OBJ_DIR)
	@echo "üß© Compiling $< ..."
	$(CC) $(CFLAGS) -c $< -o $@

# === –°–±–æ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤ ===
test: $(TEST_BIN)
	@echo "üöÄ Running tests..."
	@./$(TEST_BIN)

$(TEST_BIN): $(TEST_SRC) $(TEST_SRC_FULL) | $(BIN_DIR)
	@echo "üîß Linking tests..."
	$(CC) $(CFLAGS) $(TEST_SRC) $(TEST_SRC_FULL) -o $(TEST_BIN)
	@echo "‚úÖ Test build complete: $(TEST_BIN)"

# === –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ===
$(OBJ_DIR):
	mkdir -p $(OBJ_DIR)

$(BIN_DIR):
	mkdir -p $(BIN_DIR)

# === –û—á–∏—Å—Ç–∫–∞ ===
clean:
	@echo "üßπ Cleaning..."
	rm -rf $(OBJ_DIR) $(BIN_DIR)

# === –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã ===
run: $(TARGET)
	@echo "üöÄ Running program..."
	@./$(TARGET)

.PHONY: all clean run test
